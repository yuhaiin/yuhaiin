edition = "2023";

package yuhaiin.backup;
import "google/protobuf/go_features.proto";
import "node/point.proto";
import "node/subscribe.proto";
import "node/tag.proto";
import "config/dns.proto";
import "config/inbound.proto";
import "config/bypass.proto";

option go_package = "github.com/Asutorufa/yuhaiin/pkg/protos/backup";
option features.(pb.go).api_level = API_OPAQUE;

message nodes {
  map<string, yuhaiin.point.point> nodes = 1 [ json_name = "nodes" ];
}

message subscribes {
  map<string, yuhaiin.subscribe.link> links = 1 [ json_name = "links" ];
}

message rules {
  yuhaiin.bypass.configv2 config = 1 [ json_name = "config" ];
  repeated yuhaiin.bypass.rulev2 rules = 2 [ json_name = "rules" ];
  map<string, yuhaiin.bypass.list> lists = 3 [ json_name = "lists" ];
}

message tags { map<string, yuhaiin.tag.tags> tags = 1 [ json_name = "tags" ]; }

message backup_content {
  nodes nodes = 2 [ json_name = "nodes" ];
  subscribes subscribes = 3 [ json_name = "subscribes" ];
  yuhaiin.dns.dns_config_v2 dns = 4 [ json_name = "dns" ];
  yuhaiin.inbound.inbound_config inbounds = 5 [ json_name = "inbounds" ];
  rules rules = 6 [ json_name = "rules" ];
  tags tags = 7 [ json_name = "tag" ];
}

message restore_option {
  bool all = 1 [ json_name = "all" ];
  bool rules = 2 [ json_name = "rules" ];
  bool lists = 3 [ json_name = "lists" ];
  bool nodes = 4 [ json_name = "nodes" ];
  bool tags = 5 [ json_name = "tags" ];
  bool dns = 6 [ json_name = "dns" ];
  bool inbounds = 7 [ json_name = "inbounds" ];
  bool subscribes = 8 [ json_name = "subscribes" ];

  enum restore_source {
    unknown = 0;
    s3 = 1;
  }
  restore_source source = 9 [ json_name = "source" ];
}
